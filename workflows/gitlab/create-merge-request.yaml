name: gitlab-create-merge-request
description: Create a GitLab merge request with full details and return the MR link
version: 1.0.0
author: frostzt

mcps_required:
  - gitlab

steps:
  # Step 1: Ask for project ID
  - action: prompt.ask
    description: Get GitLab project ID
    params:
      message: "GitLab project ID (numeric ID, e.g., 12345)"
    output: project_id

  # Step 2: Ask for source branch
  - action: prompt.ask
    description: Get source branch name
    params:
      message: "Source branch (the branch with your changes)"
    output: source_branch

  # Step 3: Ask for target branch
  - action: prompt.ask
    description: Get target branch name
    params:
      message: "Target branch to merge into (default: main)"
    output: target_input

  # Step 4: Set default target branch if not provided
  - action: variable.set
    params:
      name: target_branch
      value: "main"
    if: "{{target_input}} == ''"

  - action: variable.set
    params:
      name: target_branch
      value: "{{target_input}}"
    if: "{{target_input}} != ''"

  # Step 5: Ask for MR title
  - action: prompt.ask
    description: Get MR title
    params:
      message: "Merge request title"
    output: title

  # Step 6: Ask for MR description
  - action: prompt.ask
    description: Get MR description
    params:
      message: "Merge request description (optional, press Enter to skip)"
    output: description

  # Step 7: Ask if it should remove source branch after merge
  - action: prompt.confirm
    description: Ask if source branch should be removed after merge
    params:
      message: "Remove source branch after merge?"
      default: true
    output: remove_source_branch

  # Step 8: Create the merge request
  - action: gitlab.create_merge_request
    description: Create a new GitLab merge request
    params:
      project_id: "{{project_id}}"
      source_branch: "{{source_branch}}"
      target_branch: "{{target_branch}}"
      title: "{{title}}"
      description: "{{description}}"
      remove_source_branch: "{{remove_source_branch}}"
    output: mr_result

  # Step 9: Display the MR link
  - action: log.info
    params:
      message: |
        
        ğŸ‰ Your merge request is ready!
        
        ğŸ“‹ Title: {{title}}
        ğŸ”€ Merging: {{source_branch}} â†’ {{target_branch}}
        ğŸ“ Project ID: {{project_id}}
        
        ğŸ”— View your MR at:
        {{mr_result.web_url}}
        
        MR Details:
        - MR ID: {{mr_result.iid}}
        - State: {{mr_result.state}}
        - Author: {{mr_result.author.name}}
