# GitHub Create PR (Non-Interactive)
# Creates a GitHub PR with provided parameters - no prompts
# Handles case where PR already exists gracefully
name: github-create-pr
description: Create a GitHub pull request (non-interactive)
version: 1.0.0
author: hackflow

mcps_required:
  - github

config_schema:
  owner:
    type: string
    description: Repository owner (username or organization)
    required: true
  
  repo:
    type: string
    description: Repository name
    required: true
  
  head:
    type: string
    description: Source branch (the branch with your changes)
    required: true
  
  base:
    type: string
    description: Target branch to merge into
    required: false
    default: "main"
  
  title:
    type: string
    description: Pull request title
    required: true
  
  body:
    type: string
    description: Pull request description
    required: false
    default: ""
  
  draft:
    type: boolean
    description: Create as draft PR
    required: false
    default: false

prompt_mode: static

steps:
  # Try to create the PR
  - action: github.create_pull_request
    description: Create GitHub pull request
    params:
      owner: "{{owner}}"
      repo: "{{repo}}"
      head: "{{head}}"
      base: "{{base}}"
      title: "{{title}}"
      body: "{{body}}"
      draft: "{{draft}}"
      maintainer_can_modify: true
    output: pr_result

  # Check if PR was created successfully (has url) or already exists
  - action: variable.set
    params:
      name: pr_created
      value: true

  - action: variable.set
    params:
      name: pr_created
      value: false
    if: '{{pr_result.url}} == ""'

  # Success case - new PR created
  - action: log.info
    params:
      message: |
        
        âœ… Pull Request Created!
        
        ğŸ“‹ Title: {{title}}
        ğŸ”€ Branch: {{head}} â†’ {{base}}
        ğŸ“ Repo: {{owner}}/{{repo}}
        ğŸ”— URL: {{pr_result.url}}
    if: '{{pr_created}} == true'

  # PR already exists case
  - action: log.info
    params:
      message: |
        
        â„¹ï¸  Pull Request Already Exists
        
        ğŸ“‹ Branch: {{head}} â†’ {{base}}
        ğŸ“ Repo: {{owner}}/{{repo}}
        ğŸ”— URL: https://github.com/{{owner}}/{{repo}}/pulls
        
        Your changes have been pushed to the existing PR.
    if: '{{pr_created}} == false'

  # Set final URL for parent workflow
  - action: variable.set
    params:
      name: final_pr_url
      value: "{{pr_result.url}}"
    if: '{{pr_created}} == true'

  - action: variable.set
    params:
      name: final_pr_url
      value: "https://github.com/{{owner}}/{{repo}}/pulls"
    if: '{{pr_created}} == false'
